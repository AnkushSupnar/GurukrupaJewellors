<?xml version="1.0" encoding="UTF-8"?>

<?import de.jensd.fx.glyphs.fontawesome.FontAwesomeIcon?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane style="-fx-background-color: #FAFAFA;" xmlns="http://javafx.com/javafx/23.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.gurukrupa.controller.transaction.ViewCustomerPaymentsController">

   <!-- Header Section -->
   <top>
      <HBox alignment="CENTER_LEFT" minHeight="45.0" prefHeight="48.0" style="-fx-background-color: linear-gradient(to right, #2E7D32, #43A047); -fx-padding: 10 20;">
         <children>
            <Button fx:id="btnBack" onAction="#handleBack" style="-fx-background-color: rgba(255,255,255,0.15); -fx-text-fill: white; -fx-background-radius: 4; -fx-padding: 5 8; -fx-cursor: hand;">
               <graphic><FontAwesomeIcon fill="#FFFFFF" glyphName="ARROW_LEFT" size="0.9em" /></graphic>
            </Button>
            <Region minWidth="12.0" />
            <FontAwesomeIcon fill="#FFFFFF" glyphName="HISTORY" size="1.2em">
               <HBox.margin><Insets right="8.0" /></HBox.margin>
            </FontAwesomeIcon>
            <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 15px;" text="View Customer Payments" textFill="#FFFFFF" />
            <Region HBox.hgrow="ALWAYS" />
            <Button fx:id="btnRefresh" onAction="#handleRefresh" style="-fx-background-color: rgba(255,255,255,0.15); -fx-text-fill: white; -fx-background-radius: 4; -fx-padding: 5 10; -fx-cursor: hand;" text="REFRESH">
               <graphic><FontAwesomeIcon fill="#FFFFFF" glyphName="REFRESH" size="0.9em" /></graphic>
            </Button>
         </children>
      </HBox>
   </top>

   <!-- Main Content -->
   <center>
      <ScrollPane fitToWidth="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED" style="-fx-background-color: transparent;">
         <content>
            <VBox spacing="12.0" style="-fx-padding: 12;">
               <children>

                  <!-- Search Filters Section -->
                  <VBox spacing="10.0" style="-fx-background-color: #FFFFFF; -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.06), 4, 0, 0, 1); -fx-padding: 14;">
                     <children>
                        <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 14px; -fx-text-fill: #212121;" text="SEARCH FILTERS" />

                        <!-- Filter Row 1: Date Range -->
                        <HBox spacing="10.0" alignment="CENTER_LEFT">
                           <children>
                              <VBox spacing="4.0" HBox.hgrow="ALWAYS">
                                 <children>
                                    <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 12px; -fx-text-fill: #424242;" text="From Date" />
                                    <DatePicker fx:id="dateFrom" promptText="Select from date" style="-fx-font-family: 'Segoe UI'; -fx-font-size: 13px;" />
                                 </children>
                              </VBox>

                              <VBox spacing="4.0" HBox.hgrow="ALWAYS">
                                 <children>
                                    <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 12px; -fx-text-fill: #424242;" text="To Date" />
                                    <DatePicker fx:id="dateTo" promptText="Select to date" style="-fx-font-family: 'Segoe UI'; -fx-font-size: 13px;" />
                                 </children>
                              </VBox>

                              <VBox spacing="4.0" HBox.hgrow="ALWAYS">
                                 <children>
                                    <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 12px; -fx-text-fill: #424242;" text="Customer (Optional)" />
                                    <HBox fx:id="customerSearchContainer" />
                                 </children>
                              </VBox>
                           </children>
                        </HBox>

                        <!-- Action Buttons -->
                        <HBox spacing="10.0" alignment="CENTER_LEFT">
                           <children>
                              <Button fx:id="btnSearch" onAction="#handleSearch" style="-fx-background-color: #388E3C; -fx-text-fill: white; -fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 12px; -fx-padding: 8 20; -fx-background-radius: 4; -fx-cursor: hand;" text="SEARCH">
                                 <graphic><FontAwesomeIcon fill="#FFFFFF" glyphName="SEARCH" size="0.9em" /></graphic>
                              </Button>
                              <Button fx:id="btnClearFilters" onAction="#handleClearFilters" style="-fx-background-color: #9E9E9E; -fx-text-fill: white; -fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 12px; -fx-padding: 8 20; -fx-background-radius: 4; -fx-cursor: hand;" text="CLEAR">
                                 <graphic><FontAwesomeIcon fill="#FFFFFF" glyphName="TIMES" size="0.9em" /></graphic>
                              </Button>
                           </children>
                        </HBox>
                     </children>
                  </VBox>

                  <!-- Summary Cards -->
                  <HBox spacing="10.0">
                     <children>
                        <!-- Total Payments Card -->
                        <VBox spacing="8.0" style="-fx-background-color: linear-gradient(to bottom right, #388E3C, #4CAF50); -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(56,142,60,0.12), 4, 0, 0, 1); -fx-padding: 14;" HBox.hgrow="ALWAYS">
                           <children>
                              <HBox alignment="CENTER_LEFT" spacing="6.0">
                                 <children>
                                    <FontAwesomeIcon fill="rgba(255,255,255,0.9)" glyphName="MONEY" size="1.1em" />
                                    <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 11px; -fx-text-fill: rgba(255,255,255,0.85);" text="TOTAL RECEIVED" />
                                 </children>
                              </HBox>
                              <Label fx:id="lblTotalPayments" style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 700; -fx-font-size: 24px; -fx-text-fill: #FFFFFF;" text="â‚¹ 0.00" />
                           </children>
                        </VBox>

                        <!-- Payment Count Card -->
                        <VBox spacing="8.0" style="-fx-background-color: linear-gradient(to bottom right, #0288D1, #03A9F4); -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(2,136,209,0.12), 4, 0, 0, 1); -fx-padding: 14;" HBox.hgrow="ALWAYS">
                           <children>
                              <HBox alignment="CENTER_LEFT" spacing="6.0">
                                 <children>
                                    <FontAwesomeIcon fill="rgba(255,255,255,0.9)" glyphName="LIST" size="1.1em" />
                                    <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 11px; -fx-text-fill: rgba(255,255,255,0.85);" text="RECEIPTS COUNT" />
                                 </children>
                              </HBox>
                              <Label fx:id="lblPaymentCount" style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 700; -fx-font-size: 24px; -fx-text-fill: #FFFFFF;" text="0" />
                           </children>
                        </VBox>

                        <!-- Customers Paid Card -->
                        <VBox spacing="8.0" style="-fx-background-color: linear-gradient(to bottom right, #F57C00, #FF9800); -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(245,124,0,0.12), 4, 0, 0, 1); -fx-padding: 14;" HBox.hgrow="ALWAYS">
                           <children>
                              <HBox alignment="CENTER_LEFT" spacing="6.0">
                                 <children>
                                    <FontAwesomeIcon fill="rgba(255,255,255,0.9)" glyphName="USERS" size="1.1em" />
                                    <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 11px; -fx-text-fill: rgba(255,255,255,0.85);" text="CUSTOMERS PAID" />
                                 </children>
                              </HBox>
                              <Label fx:id="lblCustomerCount" style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 700; -fx-font-size: 24px; -fx-text-fill: #FFFFFF;" text="0" />
                           </children>
                        </VBox>
                     </children>
                  </HBox>

                  <!-- Payments Table Section -->
                  <VBox spacing="10.0" style="-fx-background-color: #FFFFFF; -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.06), 4, 0, 0, 1); -fx-padding: 12;">
                     <children>
                        <HBox alignment="CENTER_LEFT" spacing="8.0">
                           <children>
                              <FontAwesomeIcon fill="#388E3C" glyphName="TABLE" size="1.1em" />
                              <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 13px; -fx-text-fill: #424242;" text="PAYMENT RECORDS" />
                              <Region HBox.hgrow="ALWAYS" />
                              <Label fx:id="lblRecordCount" style="-fx-font-family: 'Segoe UI'; -fx-font-size: 11px; -fx-text-fill: #757575;" text="0 records" />
                           </children>
                        </HBox>

                        <!-- Action Buttons Row -->
                        <HBox spacing="8.0" alignment="CENTER_LEFT">
                           <children>
                              <Button fx:id="btnView" onAction="#handleViewPayment" style="-fx-background-color: #2196F3; -fx-text-fill: white; -fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 11px; -fx-padding: 6 14; -fx-background-radius: 4; -fx-cursor: hand;" text="VIEW">
                                 <graphic><FontAwesomeIcon fill="#FFFFFF" glyphName="EYE" size="0.8em" /></graphic>
                              </Button>
                              <Button fx:id="btnPrint" onAction="#handlePrintPayment" style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 11px; -fx-padding: 6 14; -fx-background-radius: 4; -fx-cursor: hand;" text="PRINT">
                                 <graphic><FontAwesomeIcon fill="#FFFFFF" glyphName="PRINT" size="0.8em" /></graphic>
                              </Button>
                              <Region HBox.hgrow="ALWAYS" />
                              <Button fx:id="btnExport" onAction="#handleExport" style="-fx-background-color: #FF9800; -fx-text-fill: white; -fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 11px; -fx-padding: 6 14; -fx-background-radius: 4; -fx-cursor: hand;" text="EXPORT">
                                 <graphic><FontAwesomeIcon fill="#FFFFFF" glyphName="DOWNLOAD" size="0.8em" /></graphic>
                              </Button>
                           </children>
                        </HBox>

                        <!-- Table -->
                        <TableView fx:id="paymentsTable" style="-fx-background-color: #FAFAFA; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-border-width: 1;">
                           <columns>
                              <TableColumn fx:id="colReceiptNumber" prefWidth="130.0" text="Receipt #" style="-fx-alignment: CENTER-LEFT;" />
                              <TableColumn fx:id="colDate" prefWidth="110.0" text="Date" style="-fx-alignment: CENTER;" />
                              <TableColumn fx:id="colCustomer" prefWidth="200.0" text="Customer" style="-fx-alignment: CENTER-LEFT;" />
                              <TableColumn fx:id="colAmount" prefWidth="120.0" text="Amount" style="-fx-alignment: CENTER-RIGHT;" />
                              <TableColumn fx:id="colPaymentMode" prefWidth="100.0" text="Mode" style="-fx-alignment: CENTER;" />
                              <TableColumn fx:id="colBankAccount" prefWidth="180.0" text="Bank Account" style="-fx-alignment: CENTER-LEFT;" />
                              <TableColumn fx:id="colTransactionRef" prefWidth="140.0" text="Transaction Ref" style="-fx-alignment: CENTER;" />
                              <TableColumn fx:id="colPreviousPending" prefWidth="130.0" text="Prev. Pending" style="-fx-alignment: CENTER-RIGHT;" />
                              <TableColumn fx:id="colRemainingPending" prefWidth="130.0" text="Remaining" style="-fx-alignment: CENTER-RIGHT;" />
                           </columns>
                           <columnResizePolicy>
                              <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                           </columnResizePolicy>
                        </TableView>
                     </children>
                  </VBox>

               </children>
            </VBox>
         </content>
      </ScrollPane>
   </center>
</BorderPane>
