<?xml version="1.0" encoding="UTF-8"?>

<?import de.jensd.fx.glyphs.fontawesome.FontAwesomeIcon?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane style="-fx-background-color: #FAFAFA;" xmlns="http://javafx.com/javafx/23.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.gurukrupa.controller.transaction.CustomerPaymentController">

   <!-- Header Section -->
   <top>
      <HBox alignment="CENTER_LEFT" minHeight="45.0" prefHeight="48.0" style="-fx-background-color: linear-gradient(to right, #2E7D32, #388E3C); -fx-padding: 10 20;">
         <children>
            <Button fx:id="btnBack" onAction="#handleBack" style="-fx-background-color: rgba(255,255,255,0.15); -fx-text-fill: white; -fx-background-radius: 4; -fx-padding: 5 8; -fx-cursor: hand;">
               <graphic><FontAwesomeIcon fill="#FFFFFF" glyphName="ARROW_LEFT" size="0.9em" /></graphic>
            </Button>
            <Region minWidth="12.0" />
            <FontAwesomeIcon fill="#FFFFFF" glyphName="MONEY" size="1.2em">
               <HBox.margin><Insets right="8.0" /></HBox.margin>
            </FontAwesomeIcon>
            <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 15px;" text="Customer Payment Receipt" textFill="#FFFFFF" />
            <Region HBox.hgrow="ALWAYS" />
            <Label fx:id="lblReceiptNumber" style="-fx-font-family: 'Segoe UI'; -fx-font-size: 12px; -fx-text-fill: #FFFFFF; -fx-background-color: rgba(0,0,0,0.15); -fx-background-radius: 3; -fx-padding: 3 8;" text="Receipt #: CPR-20250101-0001" />
         </children>
      </HBox>
   </top>

   <!-- Main Content -->
   <center>
      <ScrollPane fitToWidth="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED" style="-fx-background-color: transparent;">
         <content>
            <VBox spacing="12.0" style="-fx-padding: 12;">
               <children>

                  <!-- Row 1: Select Customer -->
                  <VBox spacing="6.0" style="-fx-background-color: #FFFFFF; -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.06), 4, 0, 0, 1); -fx-padding: 12;">
                     <children>
                        <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 13px; -fx-text-fill: #212121;" text="SELECT CUSTOMER *" />
                        <HBox spacing="8.0" alignment="CENTER_LEFT">
                           <children>
                              <HBox fx:id="customerSearchContainer" HBox.hgrow="ALWAYS" minWidth="0" />
                              <Button fx:id="btnLoadCustomer" onAction="#handleLoadCustomer" style="-fx-background-color: #388E3C; -fx-text-fill: white; -fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 12px; -fx-padding: 8 20; -fx-background-radius: 4; -fx-cursor: hand;"
                                      text="LOAD">
                                 <graphic><FontAwesomeIcon fill="#FFFFFF" glyphName="DOWNLOAD" size="0.9em" /></graphic>
                              </Button>
                           </children>
                        </HBox>
                     </children>
                  </VBox>

                  <!-- Row 2: Total Pending & Pending Bills Cards -->
                  <HBox spacing="10.0">
                     <children>
                        <!-- Total Pending Card -->
                        <VBox spacing="8.0" style="-fx-background-color: linear-gradient(to bottom right, #D32F2F, #F44336); -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(211,47,47,0.12), 4, 0, 0, 1); -fx-padding: 12;" HBox.hgrow="ALWAYS">
                           <children>
                              <HBox alignment="CENTER_LEFT" spacing="6.0">
                                 <children>
                                    <FontAwesomeIcon fill="rgba(255,255,255,0.9)" glyphName="EXCLAMATION_CIRCLE" size="1.1em" />
                                    <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 11px; -fx-text-fill: rgba(255,255,255,0.85);" text="TOTAL PENDING" />
                                 </children>
                              </HBox>
                              <Label fx:id="lblTotalPending" style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 700; -fx-font-size: 24px; -fx-text-fill: #FFFFFF;" text="₹ 0.00" />
                           </children>
                        </VBox>

                        <!-- Pending Bills Card -->
                        <VBox spacing="8.0" style="-fx-background-color: linear-gradient(to bottom right, #1976D2, #2196F3); -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(25,118,210,0.12), 4, 0, 0, 1); -fx-padding: 12;" HBox.hgrow="ALWAYS">
                           <children>
                              <HBox alignment="CENTER_LEFT" spacing="6.0">
                                 <children>
                                    <FontAwesomeIcon fill="rgba(255,255,255,0.9)" glyphName="FILE_TEXT" size="1.1em" />
                                    <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 11px; -fx-text-fill: rgba(255,255,255,0.85);" text="PENDING BILLS" />
                                 </children>
                              </HBox>
                              <HBox alignment="CENTER_LEFT" spacing="10.0">
                                 <children>
                                    <Label fx:id="lblPendingBillsCount" style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 700; -fx-font-size: 24px; -fx-text-fill: #FFFFFF;" text="0" />
                                    <Button fx:id="btnViewPendingBills" onAction="#handleViewPendingBills" style="-fx-background-color: rgba(255,255,255,0.2); -fx-text-fill: white; -fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 10px; -fx-padding: 4 8; -fx-background-radius: 3; -fx-cursor: hand;" text="VIEW DETAILS" />
                                 </children>
                              </HBox>
                           </children>
                        </VBox>
                     </children>
                  </HBox>

                  <!-- Row 3: Payment Date, Payment Amount, Payment Mode -->
                  <HBox spacing="10.0">
                     <children>
                        <VBox spacing="6.0" style="-fx-background-color: #FFFFFF; -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.06), 4, 0, 0, 1); -fx-padding: 10;" HBox.hgrow="ALWAYS">
                           <children>
                              <Label style="-fx-text-fill: #212121; -fx-font-weight: 600; -fx-font-size: 13px; -fx-font-family: 'Segoe UI';" text="Payment Date" />
                              <DatePicker fx:id="datePaymentDate" maxWidth="Infinity"
                                        style="-fx-background-color: #FFFFFF; -fx-background-radius: 4; -fx-font-size: 13px; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-border-width: 1; -fx-font-family: 'Segoe UI';" />
                           </children>
                        </VBox>
                        <VBox spacing="6.0" style="-fx-background-color: #FFFFFF; -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.06), 4, 0, 0, 1); -fx-padding: 10;" HBox.hgrow="ALWAYS">
                           <children>
                              <Label style="-fx-text-fill: #212121; -fx-font-weight: 600; -fx-font-size: 13px; -fx-font-family: 'Segoe UI';" text="Payment Amount *" />
                              <TextField fx:id="txtPaymentAmount" promptText="0.00" maxWidth="Infinity"
                                        style="-fx-background-color: #F9F9F9; -fx-background-radius: 4; -fx-padding: 8; -fx-font-size: 13px; -fx-border-color: #388E3C; -fx-border-radius: 4; -fx-border-width: 1.5; -fx-font-family: 'Segoe UI';" />
                           </children>
                        </VBox>
                        <VBox spacing="6.0" style="-fx-background-color: #FFFFFF; -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.06), 4, 0, 0, 1); -fx-padding: 10;" HBox.hgrow="ALWAYS">
                           <children>
                              <Label style="-fx-text-fill: #212121; -fx-font-weight: 600; -fx-font-size: 13px; -fx-font-family: 'Segoe UI';" text="Payment Mode *" />
                              <ComboBox fx:id="cmbPaymentMode" maxWidth="Infinity" promptText="Select mode"
                                       style="-fx-background-color: #FFFFFF; -fx-background-radius: 4; -fx-font-family: 'Segoe UI'; -fx-font-size: 13px; -fx-padding: 6; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-border-width: 1;" />
                           </children>
                        </VBox>
                     </children>
                  </HBox>

                  <!-- Row 4: Bank Account, Transaction Reference, Notes -->
                  <HBox spacing="10.0">
                     <children>
                        <VBox spacing="6.0" style="-fx-background-color: #FFFFFF; -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.06), 4, 0, 0, 1); -fx-padding: 10;" HBox.hgrow="ALWAYS">
                           <children>
                              <Label style="-fx-text-fill: #212121; -fx-font-weight: 600; -fx-font-size: 13px; -fx-font-family: 'Segoe UI';" text="Bank Account *" />
                              <ComboBox fx:id="cmbBankAccount" maxWidth="Infinity" promptText="Select bank account"
                                       style="-fx-background-color: #FFFFFF; -fx-background-radius: 4; -fx-font-family: 'Segoe UI'; -fx-font-size: 13px; -fx-padding: 6; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-border-width: 1;" />
                           </children>
                        </VBox>
                        <VBox spacing="6.0" style="-fx-background-color: #FFFFFF; -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.06), 4, 0, 0, 1); -fx-padding: 10;" HBox.hgrow="ALWAYS">
                           <children>
                              <Label style="-fx-text-fill: #212121; -fx-font-weight: 600; -fx-font-size: 13px; -fx-font-family: 'Segoe UI';" text="Transaction Reference" />
                              <TextField fx:id="txtTransactionRef" promptText="Cheque/UPI/NEFT ref" maxWidth="Infinity"
                                        style="-fx-background-color: #F9F9F9; -fx-background-radius: 4; -fx-padding: 8; -fx-font-size: 13px; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-border-width: 1; -fx-font-family: 'Segoe UI';" />
                           </children>
                        </VBox>
                        <VBox spacing="6.0" style="-fx-background-color: #FFFFFF; -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.06), 4, 0, 0, 1); -fx-padding: 10;" HBox.hgrow="ALWAYS">
                           <children>
                              <Label style="-fx-text-fill: #212121; -fx-font-weight: 600; -fx-font-size: 13px; -fx-font-family: 'Segoe UI';" text="Notes" />
                              <TextArea fx:id="txtNotes" prefRowCount="1" promptText="Additional notes..." maxWidth="Infinity"
                                       style="-fx-background-color: #F9F9F9; -fx-background-radius: 4; -fx-padding: 6; -fx-font-size: 13px; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-border-width: 1; -fx-font-family: 'Segoe UI';" />
                           </children>
                        </VBox>
                     </children>
                  </HBox>

                  <!-- Row 5: Remaining Amount & Action Buttons -->
                  <HBox spacing="10.0" alignment="CENTER_LEFT" style="-fx-background-color: #FFFFFF; -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.06), 4, 0, 0, 1); -fx-padding: 12;">
                     <children>
                        <!-- Remaining Amount Display -->
                        <VBox spacing="4.0" style="-fx-background-color: #E8F5E9; -fx-background-radius: 4; -fx-padding: 10;" HBox.hgrow="ALWAYS">
                           <children>
                              <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 12px; -fx-text-fill: #424242;" text="Remaining Amount After Payment:" />
                              <Label fx:id="lblRemainingAmount" style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 700; -fx-font-size: 18px; -fx-text-fill: #2E7D32;" text="₹ 0.00" />
                           </children>
                        </VBox>

                        <!-- Action Buttons -->
                        <Button fx:id="btnSavePayment" onAction="#handleSavePayment"
                                style="-fx-background-color: #388E3C; -fx-text-fill: white; -fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 13px; -fx-padding: 12 24; -fx-background-radius: 4; -fx-cursor: hand; -fx-effect: dropshadow(three-pass-box, rgba(56,142,60,0.25), 4, 0, 0, 1);"
                                text="SAVE PAYMENT">
                           <graphic><FontAwesomeIcon fill="#FFFFFF" glyphName="SAVE" size="1.0em" /></graphic>
                        </Button>

                        <Button fx:id="btnClearForm" onAction="#handleClearForm"
                                style="-fx-background-color: #9E9E9E; -fx-text-fill: white; -fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 13px; -fx-padding: 12 20; -fx-background-radius: 4; -fx-cursor: hand;"
                                text="CLEAR">
                           <graphic><FontAwesomeIcon fill="#FFFFFF" glyphName="ERASER" size="1.0em" /></graphic>
                        </Button>
                     </children>
                  </HBox>

                  <!-- Row 6: Recent Payments Table -->
                  <VBox spacing="10.0" style="-fx-background-color: #FFFFFF; -fx-background-radius: 6; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.06), 4, 0, 0, 1); -fx-padding: 12;">
                     <children>
                        <HBox alignment="CENTER_LEFT" spacing="8.0">
                           <children>
                              <FontAwesomeIcon fill="#388E3C" glyphName="HISTORY" size="1.1em" />
                              <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 13px; -fx-text-fill: #424242;" text="RECENT PAYMENTS" />
                              <Region HBox.hgrow="ALWAYS" />
                              <Label fx:id="lblPaymentCount" style="-fx-font-family: 'Segoe UI'; -fx-font-size: 11px; -fx-text-fill: #757575;" text="0 payments" />
                           </children>
                        </HBox>

                        <!-- Date Filters & Actions -->
                        <HBox spacing="8.0" alignment="CENTER_LEFT">
                           <children>
                              <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 11px; -fx-text-fill: #616161;" text="From:" />
                              <DatePicker fx:id="historyDateFrom" prefWidth="120.0" style="-fx-font-family: 'Segoe UI'; -fx-font-size: 11px;" />

                              <Label style="-fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 11px; -fx-text-fill: #616161;" text="To:" />
                              <DatePicker fx:id="historyDateTo" prefWidth="120.0" style="-fx-font-family: 'Segoe UI'; -fx-font-size: 11px;" />

                              <Button fx:id="btnSearchHistory" onAction="#handleSearchHistory"
                                      style="-fx-background-color: #388E3C; -fx-text-fill: white; -fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 11px; -fx-padding: 5 10; -fx-background-radius: 4; -fx-cursor: hand;"
                                      text="SEARCH">
                                 <graphic><FontAwesomeIcon fill="#FFFFFF" glyphName="SEARCH" size="0.8em" /></graphic>
                              </Button>

                              <Button fx:id="btnClearHistory" onAction="#handleClearHistory"
                                      style="-fx-background-color: #9E9E9E; -fx-text-fill: white; -fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 11px; -fx-padding: 5 10; -fx-background-radius: 4; -fx-cursor: hand;"
                                      text="CLEAR">
                                 <graphic><FontAwesomeIcon fill="#FFFFFF" glyphName="TIMES" size="0.8em" /></graphic>
                              </Button>

                              <Region HBox.hgrow="ALWAYS" />

                              <Button fx:id="btnViewReceipt" onAction="#handleViewReceipt"
                                      style="-fx-background-color: #2196F3; -fx-text-fill: white; -fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 11px; -fx-padding: 5 12; -fx-background-radius: 4; -fx-cursor: hand;"
                                      text="VIEW">
                                 <graphic><FontAwesomeIcon fill="#FFFFFF" glyphName="EYE" size="0.8em" /></graphic>
                              </Button>

                              <Button fx:id="btnPrintReceipt" onAction="#handlePrintReceipt"
                                      style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-font-family: 'Segoe UI'; -fx-font-weight: 600; -fx-font-size: 11px; -fx-padding: 5 12; -fx-background-radius: 4; -fx-cursor: hand;"
                                      text="PRINT">
                                 <graphic><FontAwesomeIcon fill="#FFFFFF" glyphName="PRINT" size="0.8em" /></graphic>
                              </Button>
                           </children>
                        </HBox>

                        <!-- Responsive Table -->
                        <TableView fx:id="paymentHistoryTable" style="-fx-background-color: #FAFAFA; -fx-border-color: #E0E0E0; -fx-border-radius: 4; -fx-border-width: 1;">
                           <columns>
                              <TableColumn fx:id="colReceiptNumber" prefWidth="120.0" text="Receipt #" style="-fx-alignment: CENTER-LEFT;" />
                              <TableColumn fx:id="colPaymentDate" prefWidth="120.0" text="Date" style="-fx-alignment: CENTER;" />
                              <TableColumn fx:id="colCustomerName" prefWidth="200.0" text="Customer" style="-fx-alignment: CENTER-LEFT;" />
                              <TableColumn fx:id="colPaymentAmount" prefWidth="120.0" text="Amount" style="-fx-alignment: CENTER-RIGHT;" />
                              <TableColumn fx:id="colPaymentMode" prefWidth="100.0" text="Mode" style="-fx-alignment: CENTER;" />
                              <TableColumn fx:id="colBankAccount" prefWidth="150.0" text="Bank Account" style="-fx-alignment: CENTER-LEFT;" />
                              <TableColumn fx:id="colTransactionRef" prefWidth="120.0" text="Reference" style="-fx-alignment: CENTER;" />
                           </columns>
                           <columnResizePolicy>
                              <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                           </columnResizePolicy>
                        </TableView>
                     </children>
                  </VBox>

               </children>
            </VBox>
         </content>
      </ScrollPane>
   </center>
</BorderPane>
